<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Picker Timezone Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .current-date {
            background: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .expected-date {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .status {
            font-weight: bold;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #cce7ff; color: #004085; border: 1px solid #b3d7ff; }
    </style>
</head>
<body>
    <h1>Date Picker Timezone Debug</h1>
    
    <div class="debug-section">
        <h2>Current Date Analysis (UTC+7 physical, America/Los_Angeles setting)</h2>
        
        <div class="current-date">
            <h3>Physical Location Time (UTC+7):</h3>
            <p id="physical-time"></p>
            <p id="physical-date"></p>
        </div>
        
        <div class="expected-date">
            <h3>User's Timezone Setting (America/Los_Angeles):</h3>
            <p id="user-tz-time"></p>
            <p id="user-tz-date"></p>
        </div>
        
        <div class="status" id="status"></div>
        
        <h3>Date Picker Expected Behavior:</h3>
        <ul>
            <li><strong>Current date highlighting</strong> should show <span id="expected-highlight"></span> (Los Angeles date)</li>
            <li><strong>Today filter</strong> should query for <span id="expected-today-range"></span></li>
            <li><strong>Max selectable date</strong> should be <span id="expected-max-date"></span></li>
        </ul>
        
        <div class="info">
            <p><strong>Test Instructions:</strong></p>
            <ol>
                <li>Open the Productivity Insights page</li>
                <li>Click on the date range filter and select "Time range"</li>
                <li>Check that the calendar highlights <strong id="today-highlight"></strong> as "today" (with red circle)</li>
                <li>Verify you cannot select future dates beyond <strong id="max-selectable"></strong></li>
                <li>Test that "Today" filter shows data for <strong id="today-filter"></strong></li>
            </ol>
        </div>
    </div>

    <script>
        // Mock user timezone setting (America/Los_Angeles)
        const userTimezone = 'America/Los_Angeles';
        
        // Get current time in physical location (UTC+7)
        const physicalTime = new Date();
        document.getElementById('physical-time').textContent = physicalTime.toLocaleString('en-US', { 
            timeZone: 'Asia/Bangkok',
            weekday: 'long',
            year: 'numeric',
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            timeZoneName: 'short'
        });
        document.getElementById('physical-date').textContent = 'Date: ' + physicalTime.toLocaleDateString('en-US', { 
            timeZone: 'Asia/Bangkok'
        });
        
        // Get current time in user's configured timezone
        const userTZTime = new Date(physicalTime.toLocaleString("en-US", { timeZone: userTimezone }));
        document.getElementById('user-tz-time').textContent = physicalTime.toLocaleString('en-US', { 
            timeZone: userTimezone,
            weekday: 'long',
            year: 'numeric',
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            timeZoneName: 'short'
        });
        
        const userTZDate = physicalTime.toLocaleDateString('en-US', { 
            timeZone: userTimezone
        });
        document.getElementById('user-tz-date').textContent = 'Date: ' + userTZDate;
        
        // Calculate today in user's timezone for highlighting
        const nowInUserTZ = new Date(physicalTime.toLocaleString("en-US", { timeZone: userTimezone }));
        const todayInUserTZ = new Date(nowInUserTZ.getFullYear(), nowInUserTZ.getMonth(), nowInUserTZ.getDate());
        
        // Expected behavior
        const expectedHighlight = todayInUserTZ.toLocaleDateString('en-US', { 
            month: 'long', 
            day: 'numeric',
            year: 'numeric'
        });
        
        document.getElementById('expected-highlight').textContent = expectedHighlight;
        document.getElementById('expected-today-range').textContent = expectedHighlight;
        document.getElementById('expected-max-date').textContent = expectedHighlight;
        document.getElementById('today-highlight').textContent = expectedHighlight;
        document.getElementById('max-selectable').textContent = expectedHighlight;
        document.getElementById('today-filter').textContent = expectedHighlight;
        
        // Status check
        const physicalDateStr = physicalTime.toLocaleDateString('en-US', { timeZone: 'Asia/Bangkok' });
        const userTZDateStr = physicalTime.toLocaleDateString('en-US', { timeZone: userTimezone });
        
        const statusEl = document.getElementById('status');
        if (physicalDateStr !== userTZDateStr) {
            statusEl.className = 'status success';
            statusEl.innerHTML = '‚úÖ <strong>Perfect test scenario!</strong> Physical date (' + physicalDateStr + ') differs from user timezone date (' + userTZDateStr + ')';
        } else {
            statusEl.className = 'status info';
            statusEl.innerHTML = 'üïê <strong>Note:</strong> Both dates are the same today. Timezone difference will be more apparent at different times.';
        }
        
        // Log debug info
        console.log('DatePicker Debug Info:', {
            physicalLocation: 'UTC+7 (Asia/Bangkok)',
            userTimezoneSetting: userTimezone,
            physicalTime: physicalTime.toISOString(),
            userTZTime: nowInUserTZ.toISOString(),
            todayInUserTZ: todayInUserTZ.toISOString(),
            expectedHighlight: expectedHighlight,
            dateDifference: physicalDateStr !== userTZDateStr
        });
    </script>
</body>
</html>