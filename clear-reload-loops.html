<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Emergency Disable</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .urgent { background: #ff4444; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; }
        .success { background: #4caf50; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .info { background: #2196f3; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 10px; border: none; border-radius: 8px; }
        .btn-urgent { background: #ff4444; color: white; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-family: monospace; }
    </style>
</head>
<body>
    <div class="urgent">
        <h1>üö® EMERGENCY DISABLE ACTIVE</h1>
        <p><strong>Problem:</strong> <code>isEmergencyDisabled: true</code> is blocking UTC sessions</p>
        <p><strong>Solution:</strong> Clear the emergency disable flag immediately</p>
    </div>

    <div id="status"></div>

    <button class="btn-urgent" onclick="clearEmergencyDisable()">üî• CLEAR EMERGENCY DISABLE NOW</button>

    <div class="info">
        <h3>üéØ What This Does</h3>
        <p>This will remove the <code>utc-emergency-disable</code> key from localStorage that's preventing UTC sessions from being created.</p>
    </div>

    <div class="info">
        <h3>üìã Manual Fix (Run in Console)</h3>
        <pre>// At localhost:3004 console, run:
localStorage.removeItem('utc-emergency-disable');
console.log('Emergency disable cleared:', localStorage.getItem('utc-emergency-disable'));
// Should log: Emergency disable cleared: null</pre>
    </div>

    <script>
        function clearEmergencyDisable() {
            const statusDiv = document.getElementById('status');
            
            try {
                // Check current state
                const before = localStorage.getItem('utc-emergency-disable');
                console.log('Before clear:', before);
                
                // Clear the emergency disable
                localStorage.removeItem('utc-emergency-disable');
                
                // Verify it's cleared  
                const after = localStorage.getItem('utc-emergency-disable');
                console.log('After clear:', after);
                
                if (after === null) {
                    statusDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ SUCCESS!</h3>
                            <p><strong>Emergency disable cleared!</strong></p>
                            <p>Before: <code>${before}</code></p>
                            <p>After: <code>${after}</code></p>
                            <p>üéØ Now go to localhost:3004 and test session creation!</p>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="urgent">
                            <h3>‚ùå FAILED</h3>
                            <p>Emergency disable still active: <code>${after}</code></p>
                            <p>Try the manual console command instead.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="urgent">
                        <h3>‚ùå ERROR</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                console.error('Error clearing emergency disable:', error);
            }
        }

        // Auto-check current state
        setTimeout(() => {
            const current = localStorage.getItem('utc-emergency-disable');
            const statusDiv = document.getElementById('status');
            
            if (current === 'true') {
                statusDiv.innerHTML = `
                    <div class="urgent">
                        <h3>üö® CONFIRMED: Emergency Disable Active</h3>
                        <p>Current value: <code>${current}</code></p>
                        <p>This explains why sessions are going to legacy system!</p>
                    </div>
                `;
            } else if (current === null) {
                statusDiv.innerHTML = `
                    <div class="success">
                        <h3>‚úÖ Emergency Disable Already Cleared</h3>
                        <p>The emergency disable flag is not set.</p>
                        <p>If sessions are still going to legacy, there may be another issue.</p>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div class="info">
                        <h3>üîç Unexpected Value</h3>
                        <p>Current value: <code>${current}</code></p>
                        <p>Expected: null or 'true'</p>
                    </div>
                `;
            }
        }, 500);
    </script>
</body>
</html>